"""
Setup Community Subjects - Seed data for StudyHub marketplace
Creates standardized subject topics that creators can publish courses to

Run: python setup_community_subjects.py
"""

from src.database.db_manager import DBManager
from datetime import datetime
import logging

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)


COMMUNITY_SUBJECTS = [
    # ==================== IT CATEGORY ====================
    {
        "_id": "python-programming",
        "slug": "python-programming",
        "title": "Python Programming",
        "title_vi": "L·∫≠p tr√¨nh Python",
        "description": "Learn Python programming from basics to advanced concepts",
        "description_vi": "H·ªçc l·∫≠p tr√¨nh Python t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao",
        "category": "it",
        "icon": "üêç",
        "keywords": ["python", "programming", "coding", "software"],
        "meta_description": "Master Python programming with courses from expert instructors",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 1,
    },
    {
        "_id": "javascript-programming",
        "slug": "javascript-programming",
        "title": "JavaScript Programming",
        "title_vi": "L·∫≠p tr√¨nh JavaScript",
        "description": "Master JavaScript from fundamentals to advanced frameworks",
        "description_vi": "L√†m ch·ªß JavaScript t·ª´ c∆° b·∫£n ƒë·∫øn framework n√¢ng cao",
        "category": "it",
        "icon": "üìú",
        "keywords": ["javascript", "js", "web", "frontend"],
        "meta_description": "Learn JavaScript programming and web development",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 2,
    },
    {
        "_id": "react-development",
        "slug": "react-development",
        "title": "React Development",
        "title_vi": "Ph√°t tri·ªÉn React",
        "description": "Build modern web applications with React",
        "description_vi": "X√¢y d·ª±ng ·ª©ng d·ª•ng web hi·ªán ƒë·∫°i v·ªõi React",
        "category": "it",
        "icon": "‚öõÔ∏è",
        "keywords": ["react", "reactjs", "frontend", "ui"],
        "meta_description": "Master React development and build scalable applications",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 3,
    },
    {
        "_id": "nodejs-development",
        "slug": "nodejs-development",
        "title": "Node.js Development",
        "title_vi": "Ph√°t tri·ªÉn Node.js",
        "description": "Server-side JavaScript with Node.js",
        "description_vi": "JavaScript ph√≠a server v·ªõi Node.js",
        "category": "it",
        "icon": "üü¢",
        "keywords": ["nodejs", "backend", "server", "api"],
        "meta_description": "Learn Node.js backend development",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": False,
        "display_order": 4,
    },
    {
        "_id": "web-development",
        "slug": "web-development",
        "title": "Web Development",
        "title_vi": "Ph√°t tri·ªÉn Web",
        "description": "Full stack web development from HTML to deployment",
        "description_vi": "Ph√°t tri·ªÉn web full stack t·ª´ HTML ƒë·∫øn tri·ªÉn khai",
        "category": "it",
        "icon": "üåê",
        "keywords": ["web", "html", "css", "fullstack"],
        "meta_description": "Complete web development courses",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 5,
    },
    {
        "_id": "data-science",
        "slug": "data-science",
        "title": "Data Science",
        "title_vi": "Khoa h·ªçc D·ªØ li·ªáu",
        "description": "Data analysis, machine learning, and AI",
        "description_vi": "Ph√¢n t√≠ch d·ªØ li·ªáu, machine learning v√† AI",
        "category": "it",
        "icon": "üìä",
        "keywords": ["data", "science", "ml", "ai", "analytics"],
        "meta_description": "Master data science and machine learning",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 6,
    },
    {
        "_id": "mobile-app-development",
        "slug": "mobile-app-development",
        "title": "Mobile App Development",
        "title_vi": "Ph√°t tri·ªÉn ·ª®ng d·ª•ng Di ƒë·ªông",
        "description": "Build iOS and Android applications",
        "description_vi": "X√¢y d·ª±ng ·ª©ng d·ª•ng iOS v√† Android",
        "category": "it",
        "icon": "üì±",
        "keywords": ["mobile", "ios", "android", "app"],
        "meta_description": "Learn mobile app development",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": False,
        "display_order": 7,
    },
    {
        "_id": "database-design",
        "slug": "database-design",
        "title": "Database Design",
        "title_vi": "Thi·∫øt k·∫ø C∆° s·ªü D·ªØ li·ªáu",
        "description": "SQL, NoSQL, and database architecture",
        "description_vi": "SQL, NoSQL v√† ki·∫øn tr√∫c c∆° s·ªü d·ªØ li·ªáu",
        "category": "it",
        "icon": "üóÑÔ∏è",
        "keywords": ["database", "sql", "nosql", "mongodb"],
        "meta_description": "Master database design and management",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": False,
        "display_order": 8,
    },
    # ==================== BUSINESS CATEGORY ====================
    {
        "_id": "marketing-fundamentals",
        "slug": "marketing-fundamentals",
        "title": "Marketing Fundamentals",
        "title_vi": "C∆° b·∫£n Marketing",
        "description": "Essential marketing concepts and strategies",
        "description_vi": "C√°c kh√°i ni·ªám v√† chi·∫øn l∆∞·ª£c marketing c∆° b·∫£n",
        "category": "business",
        "icon": "üìä",
        "keywords": ["marketing", "business", "strategy"],
        "meta_description": "Learn marketing fundamentals",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 1,
    },
    {
        "_id": "digital-marketing",
        "slug": "digital-marketing",
        "title": "Digital Marketing",
        "title_vi": "Marketing S·ªë",
        "description": "Online marketing, SEO, social media, and ads",
        "description_vi": "Marketing online, SEO, m·∫°ng x√£ h·ªôi v√† qu·∫£ng c√°o",
        "category": "business",
        "icon": "üíª",
        "keywords": ["digital", "marketing", "seo", "social"],
        "meta_description": "Master digital marketing strategies",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 2,
    },
    {
        "_id": "entrepreneurship",
        "slug": "entrepreneurship",
        "title": "Entrepreneurship",
        "title_vi": "Kh·ªüi nghi·ªáp",
        "description": "Start and grow your own business",
        "description_vi": "Kh·ªüi nghi·ªáp v√† ph√°t tri·ªÉn doanh nghi·ªáp",
        "category": "business",
        "icon": "üöÄ",
        "keywords": ["startup", "entrepreneur", "business"],
        "meta_description": "Learn how to start your own business",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 3,
    },
    {
        "_id": "financial-management",
        "slug": "financial-management",
        "title": "Financial Management",
        "title_vi": "Qu·∫£n l√Ω T√†i ch√≠nh",
        "description": "Personal and business finance",
        "description_vi": "T√†i ch√≠nh c√° nh√¢n v√† doanh nghi·ªáp",
        "category": "business",
        "icon": "üí∞",
        "keywords": ["finance", "accounting", "money"],
        "meta_description": "Master financial management",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": False,
        "display_order": 4,
    },
    {
        "_id": "project-management",
        "slug": "project-management",
        "title": "Project Management",
        "title_vi": "Qu·∫£n l√Ω D·ª± √°n",
        "description": "Plan, execute, and deliver successful projects",
        "description_vi": "L·∫≠p k·∫ø ho·∫°ch, th·ª±c hi·ªán v√† giao d·ª± √°n th√†nh c√¥ng",
        "category": "business",
        "icon": "üìã",
        "keywords": ["project", "management", "agile", "scrum"],
        "meta_description": "Learn project management skills",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": False,
        "display_order": 5,
    },
    # ==================== ACADEMICS CATEGORY ====================
    {
        "_id": "toan-12",
        "slug": "toan-12",
        "title": "To√°n 12",
        "title_vi": "To√°n h·ªçc l·ªõp 12",
        "description": "Mathematics for Grade 12 - Vietnam curriculum",
        "description_vi": "To√°n h·ªçc l·ªõp 12 theo ch∆∞∆°ng tr√¨nh Vi·ªát Nam",
        "category": "academics",
        "icon": "üìê",
        "keywords": ["to√°n", "math", "grade12", "h·ªçc"],
        "meta_description": "H·ªçc To√°n 12 theo ch∆∞∆°ng tr√¨nh chu·∫©n",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 1,
    },
    {
        "_id": "vat-ly-12",
        "slug": "vat-ly-12",
        "title": "V·∫≠t l√Ω 12",
        "title_vi": "V·∫≠t l√Ω l·ªõp 12",
        "description": "Physics for Grade 12 - Vietnam curriculum",
        "description_vi": "V·∫≠t l√Ω l·ªõp 12 theo ch∆∞∆°ng tr√¨nh Vi·ªát Nam",
        "category": "academics",
        "icon": "‚öóÔ∏è",
        "keywords": ["v·∫≠t l√Ω", "physics", "grade12"],
        "meta_description": "H·ªçc V·∫≠t l√Ω 12 theo ch∆∞∆°ng tr√¨nh chu·∫©n",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 2,
    },
    {
        "_id": "hoa-hoc-12",
        "slug": "hoa-hoc-12",
        "title": "H√≥a h·ªçc 12",
        "title_vi": "H√≥a h·ªçc l·ªõp 12",
        "description": "Chemistry for Grade 12 - Vietnam curriculum",
        "description_vi": "H√≥a h·ªçc l·ªõp 12 theo ch∆∞∆°ng tr√¨nh Vi·ªát Nam",
        "category": "academics",
        "icon": "üß™",
        "keywords": ["h√≥a", "chemistry", "grade12"],
        "meta_description": "H·ªçc H√≥a h·ªçc 12 theo ch∆∞∆°ng tr√¨nh chu·∫©n",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 3,
    },
    {
        "_id": "tieng-anh-12",
        "slug": "tieng-anh-12",
        "title": "Ti·∫øng Anh 12",
        "title_vi": "Ti·∫øng Anh l·ªõp 12",
        "description": "English for Grade 12 - Vietnam curriculum",
        "description_vi": "Ti·∫øng Anh l·ªõp 12 theo ch∆∞∆°ng tr√¨nh Vi·ªát Nam",
        "category": "academics",
        "icon": "üá¨üáß",
        "keywords": ["english", "ti·∫øng anh", "grade12"],
        "meta_description": "H·ªçc Ti·∫øng Anh 12 theo ch∆∞∆°ng tr√¨nh chu·∫©n",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 4,
    },
    {
        "_id": "ielts-preparation",
        "slug": "ielts-preparation",
        "title": "IELTS Preparation",
        "title_vi": "Luy·ªán thi IELTS",
        "description": "Prepare for IELTS exam - all skills",
        "description_vi": "Luy·ªán thi IELTS - t·∫•t c·∫£ k·ªπ nƒÉng",
        "category": "academics",
        "icon": "üìö",
        "keywords": ["ielts", "english", "test", "exam"],
        "meta_description": "Complete IELTS preparation courses",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 5,
    },
    {
        "_id": "toeic-preparation",
        "slug": "toeic-preparation",
        "title": "TOEIC Preparation",
        "title_vi": "Luy·ªán thi TOEIC",
        "description": "Prepare for TOEIC exam",
        "description_vi": "Luy·ªán thi TOEIC",
        "category": "academics",
        "icon": "üìù",
        "keywords": ["toeic", "english", "test"],
        "meta_description": "TOEIC preparation and practice",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": False,
        "display_order": 6,
    },
    # ==================== LANGUAGE CATEGORY ====================
    {
        "_id": "english-speaking",
        "slug": "english-speaking",
        "title": "English Speaking",
        "title_vi": "Giao ti·∫øp Ti·∫øng Anh",
        "description": "Improve your English speaking and conversation skills",
        "description_vi": "C·∫£i thi·ªán k·ªπ nƒÉng n√≥i v√† giao ti·∫øp Ti·∫øng Anh",
        "category": "language",
        "icon": "üó£Ô∏è",
        "keywords": ["english", "speaking", "conversation"],
        "meta_description": "Master English speaking skills",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 1,
    },
    {
        "_id": "chinese-language",
        "slug": "chinese-language",
        "title": "Chinese Language",
        "title_vi": "Ti·∫øng Trung",
        "description": "Learn Mandarin Chinese from basics to advanced",
        "description_vi": "H·ªçc Ti·∫øng Trung t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao",
        "category": "language",
        "icon": "üá®üá≥",
        "keywords": ["chinese", "mandarin", "‰∏≠Êñá"],
        "meta_description": "Learn Chinese language",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 2,
    },
    {
        "_id": "japanese-language",
        "slug": "japanese-language",
        "title": "Japanese Language",
        "title_vi": "Ti·∫øng Nh·∫≠t",
        "description": "Learn Japanese from basics to JLPT",
        "description_vi": "H·ªçc Ti·∫øng Nh·∫≠t t·ª´ c∆° b·∫£n ƒë·∫øn JLPT",
        "category": "language",
        "icon": "üáØüáµ",
        "keywords": ["japanese", "Êó•Êú¨Ë™û", "jlpt"],
        "meta_description": "Learn Japanese language and culture",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 3,
    },
    {
        "_id": "korean-language",
        "slug": "korean-language",
        "title": "Korean Language",
        "title_vi": "Ti·∫øng H√†n",
        "description": "Learn Korean from basics to TOPIK",
        "description_vi": "H·ªçc Ti·∫øng H√†n t·ª´ c∆° b·∫£n ƒë·∫øn TOPIK",
        "category": "language",
        "icon": "üá∞üá∑",
        "keywords": ["korean", "ÌïúÍµ≠Ïñ¥", "topik"],
        "meta_description": "Learn Korean language and culture",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": False,
        "display_order": 4,
    },
    # ==================== DESIGN CATEGORY ====================
    {
        "_id": "graphic-design",
        "slug": "graphic-design",
        "title": "Graphic Design",
        "title_vi": "Thi·∫øt k·∫ø ƒê·ªì h·ªça",
        "description": "Master graphic design with Photoshop, Illustrator",
        "description_vi": "L√†m ch·ªß thi·∫øt k·∫ø ƒë·ªì h·ªça v·ªõi Photoshop, Illustrator",
        "category": "design",
        "icon": "üé®",
        "keywords": ["design", "graphic", "photoshop"],
        "meta_description": "Learn graphic design skills",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 1,
    },
    {
        "_id": "ui-ux-design",
        "slug": "ui-ux-design",
        "title": "UI/UX Design",
        "title_vi": "Thi·∫øt k·∫ø UI/UX",
        "description": "User interface and user experience design",
        "description_vi": "Thi·∫øt k·∫ø giao di·ªán v√† tr·∫£i nghi·ªám ng∆∞·ªùi d√πng",
        "category": "design",
        "icon": "üì±",
        "keywords": ["ui", "ux", "design", "figma"],
        "meta_description": "Master UI/UX design",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 2,
    },
    {
        "_id": "video-editing",
        "slug": "video-editing",
        "title": "Video Editing",
        "title_vi": "D·ª±ng Video",
        "description": "Professional video editing with Premiere, After Effects",
        "description_vi": "D·ª±ng video chuy√™n nghi·ªáp v·ªõi Premiere, After Effects",
        "category": "design",
        "icon": "üé¨",
        "keywords": ["video", "editing", "premiere"],
        "meta_description": "Learn video editing and production",
        "total_courses": 0,
        "total_students": 0,
        "avg_rating": 0.0,
        "is_featured": True,
        "display_order": 3,
    },
]


def setup_community_subjects():
    """Seed community subjects collection"""
    try:
        db_manager = DBManager()
        db = db_manager.db
        collection = db["community_subjects"]

        # Add timestamps
        now = datetime.utcnow()
        for subject in COMMUNITY_SUBJECTS:
            subject["created_at"] = now
            subject["updated_at"] = now

        # Drop existing collection (if re-seeding)
        # collection.drop()
        # logger.info("Dropped existing community_subjects collection")

        # Insert subjects
        result = collection.insert_many(COMMUNITY_SUBJECTS)
        logger.info(f"‚úÖ Inserted {len(result.inserted_ids)} community subjects")

        # Create indexes
        logger.info("Creating indexes...")
        collection.create_index([("slug", 1)], unique=True)
        collection.create_index([("category", 1)])
        collection.create_index([("title", "text"), ("title_vi", "text")])
        collection.create_index([("total_courses", -1)])
        collection.create_index([("total_students", -1)])
        collection.create_index([("is_featured", -1), ("display_order", 1)])
        logger.info("‚úÖ Created indexes for community_subjects")

        # Print summary
        logger.info("\n" + "=" * 60)
        logger.info("SUMMARY BY CATEGORY:")
        logger.info("=" * 60)
        for category in ["it", "business", "academics", "language", "design"]:
            count = len([s for s in COMMUNITY_SUBJECTS if s["category"] == category])
            logger.info(f"  {category.upper()}: {count} subjects")

        logger.info("\n‚úÖ Community subjects setup completed!")
        logger.info(f"Total subjects: {len(COMMUNITY_SUBJECTS)}")

    except Exception as e:
        logger.error(f"‚ùå Error setting up community subjects: {e}")
        raise


if __name__ == "__main__":
    setup_community_subjects()
